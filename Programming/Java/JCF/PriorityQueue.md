---
создал заметку: 2025-09-23T14:39:00
author: WhiteK0T
tags:
  - Java
  - Queue
  - JCF
Источник:
  - https://arenda-server.cloud/blog/prioritetnaja-ochered-v-java-kak-ispolzovat-i-realizovat/
  - https://projava-code.github.io/java-priorityqueue/
---

## Приоритетная очередь

**PriorityQueue** это класс в Java, реализующий структуру данных "очередь с приоритетом". В такой очереди элементы извлекаются не в порядке добавления, а в порядке их приоритета (по умолчанию — по возрастанию, но можно задать свой компаратор).

![](/Cache/JCF/PriorityQueue/java-priority-queue-comparator-example.png)

**Note:** Итератор, предоставленный в методе iterator(), не гарантирует обход элементов приоритетной очереди в каком-либо определенном порядке.
```java
PriorityQueue<Integer> numbers = new PriorityQueue<>();  
numbers.offer(1);  
numbers.add(3);  
numbers.add(2);  
System.out.print("Проход PriorityQueue с помощью итератора -> ");  
numbers.forEach(integer -> System.out.print(integer + " "));  
System.out.print("\nПроход PriorityQueue без итератора -> ");  
while (!numbers.isEmpty()) 
	System.out.print(numbers.poll() + " ");
```

```
Проход PriorityQueue с помощью итератора -> 1 3 2 
Проход PriorityQueue без итератора -> 1 2 3 
```
### Как это работает под капотом

**PriorityQueue** в Java реализована на основе двоичной кучи (binary heap). 
-   Вставка элемента — O(log n)
-   Извлечение минимального элемента — O(log n)
-   Просмотр минимального элемента — O(1)
-   Поиск произвольного элемента — O(n)
-   Реализует интерфейс: `Queue<E>`
-   Элементы автоматически сортируются по приоритету.
-   Не допускает `null`-элементов.
-   Не потокобезопасна (для многопоточного доступа используйте `PriorityBlockingQueue`).
### Сравнение с альтернативами

Вот сравнение PriorityQueue с другими структурами данных:

| Структура             | Вставка  | Извлечение мин. | Поиск    | Использование памяти |
| --------------------- | -------- | --------------- | -------- | -------------------- |
| PriorityQueue         | O(log n) | O(log n)        | O(n)     | Компактное           |
| TreeSet               | O(log n) | O(log n)        | O(log n) | Больше overhead      |
| ArrayList + sort      | O(1)     | O(n log n)      | O(n)     | Компактное           |
| ConcurrentSkipListSet | O(log n) | O(log n)        | O(log n) | Высокий overhead     |
### Практические кейсы и паттерны

Вот несколько реальных сценариев использования на серверах:

| Сценарий          | Плюсы                                        | Минусы                                                   | Рекомендации                                 |
| ----------------- | -------------------------------------------- | -------------------------------------------------------- | -------------------------------------------- |
| Планировщик задач | Автоматическая сортировка, O(log n) операции | Нет произвольного доступа к элементам                    | Подходит для простых очередей задач          |
| Система алертов   | Критичные события обрабатываются первыми     | Нет гарантий FIFO для элементов с одинаковым приоритетом | Добавляй timestamp для стабильной сортировки |
| Load balancer     | Можно приоритизировать запросы               | Может создать starvation для низкоприоритетных задач     | Используй aging или time-based priority      |
| Обработка логов   | ERROR логи обрабатываются первыми            | Высокая нагрузка на сортировку при большом объёме        | Рассмотри батчинг или отдельные очереди      |

### Таблица методов класса `PriorityQueue`
| Конструктор / Метод                                                    | Описание                                                                                      |
| ---------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| `PriorityQueue()`                                                      | Создаёт пустую очередь с приоритетом с начальной ёмкостью по умолчанию (обычно 11).           |
| `PriorityQueue(int initialCapacity)`                                   | Создаёт пустую очередь с указанной начальной ёмкостью.                                        |
| `PriorityQueue(int initialCapacity, Comparator<? super E> comparator)` | Создаёт пустую очередь с указанной ёмкостью и компаратором для определения порядка элементов. |
| `PriorityQueue(Collection<? extends E> c)`                             | Создаёт очередь, содержащую все элементы из коллекции `c`.                                    |
| `PriorityQueue(PriorityQueue<? extends E> c)`                          | Создаёт очередь, копируя другую очередь с приоритетом.                                        |
| `PriorityQueue(SortedSet<? extends E> c)`                              | Создаёт очередь, содержащую элементы из отсортированного множества.                           |
| `add(E e)`                                                             | Добавляет элемент в очередь. Бросает исключение при ошибке.                                   |
| `offer(E e)`                                                           | Добавляет элемент в очередь. Возвращает `false` при ошибке.                                   |
| `peek()`                                                               | Возвращает элемент с наивысшим приоритетом, не удаляя его.                                    |
| `poll()`                                                               | Возвращает и удаляет элемент с наивысшим приоритетом.                                         |
| `remove()`                                                             | Удаляет и возвращает элемент с наивысшим приоритетом.                                         |
| `clear()`                                                              | Очищает очередь.                                                                              |
| `size()`                                                               | Возвращает количество элементов в очереди.                                                    |
| `isEmpty()`                                                            | Проверяет, пуста ли очередь.                                                                  |
| `contains(Object o)`                                                   | Проверяет, содержится ли элемент в очереди.                                                   |
| `toArray()`                                                            | Возвращает массив всех элементов очереди.                                                     |
| `iterator()`                                                           | Возвращает итератор по элементам очереди.                                                     |
| `remove(Object o)`                                                     | Удаляет указанный элемент из очереди.                                                         |
